/*
   Generated by EX4 TO MQ4 decompile Service 
   Website: http://www.ex4Tomq4.net 
   E-mail : info@ex4Tomq4.net 
*/
#property copyright "Copyright 2012, Umeku"
#property link      "http://umeku.com/fx/basketInfo"
#property show_inputs

#include <WinUser32.mqh>

extern int Magic = 0;
extern int Direction = 0;
extern double TargetPrice = 0.0;

int start() {
   int li_0 = f0_3(Magic, Direction, 0);
   if (!OrderSelect(li_0, SELECT_BY_TICKET)) {
      Print("No orders open for this pair");
      return (0);
   }
   int li_4 = MarketInfo(OrderSymbol(), MODE_DIGITS);
   double ld_8 = f0_2(Magic, Direction, TargetPrice);
   double ld_16 = f0_0(Magic, Direction, ld_8);
   string ls_24 = "buy";
   if (Direction == 1) ls_24 = "sell";
   OrderSelect(li_0, SELECT_BY_TICKET);
   int li_32 = MessageBox("Will modify pair " + Magic + " " + OrderSymbol() + " (" + ls_24 + ") order " + li_0 
   + "\nT/P to " + DoubleToStr(ld_8, li_4) + " which will result in " + DoubleToStr(ld_16, 2) + " profit. \nContinue?", "Question", MB_YESNO|MB_ICONQUESTION);
   if (li_32 == IDNO) return (0);
   double ld_36 = MarketInfo(OrderSymbol(), MODE_POINT);
   double ld_44 = OrderStopLoss();
   if (MathMod(ld_44 / ld_36, 2) == 0.0) ld_44 += ld_36;
   else ld_44 -= ld_36;
   Print("Modifying...");
   OrderModify(li_0, OrderOpenPrice(), ld_44, ld_8, 0, CLR_NONE);
   return (1);
}

int f0_3(int ai_0, int ai_4, bool ai_8) {
   int li_12;
   int li_20 = OrdersTotal();
   for (int li_16 = 0; li_16 < li_20; li_16++) {
      if (OrderSelect(li_16, SELECT_BY_POS)) {
         if (ai_4 == OrderType()) {
            if (OrderMagicNumber() == ai_0) {
               li_12 = OrderTicket();
               if (ai_8) return (li_12);
            }
         }
      }
   }
   return (li_12);
}

double f0_2(int ai_0, int ai_4, double ad_8) {
   double ld_32;
   double ld_40;
   double ld_48;
   int li_28 = OrdersTotal();
   int li_24 = f0_3(ai_0, ai_4, 0);
   if (OrderSelect(li_24, SELECT_BY_TICKET)) {
      ld_32 = OrderOpenPrice();
      ld_40 = -1;
      ld_48 = MarketInfo(OrderSymbol(), MODE_POINT);
      while (ld_40 <= ad_8) {
         if (ai_4 == OP_BUY) ld_32 += ld_48;
         else ld_32 -= ld_48;
         ld_40 = 0;
         for (int li_20 = 0; li_20 < li_28; li_20++) {
            if (OrderSelect(li_20, SELECT_BY_POS)) {
               if (ai_4 == OrderType())
                  if (OrderMagicNumber() == ai_0) ld_40 += f0_1(OrderLots(), OrderOpenPrice(), ld_32, ai_4, OrderSymbol()) + OrderCommission() + OrderSwap();
            }
         }
      }
   }
   return (ld_32);
}

double f0_1(double ad_0, double ad_8, double ad_16, int ai_24, string as_28) {
   double ld_36 = MarketInfo(as_28, MODE_TICKVALUE) / MarketInfo(as_28, MODE_TICKSIZE);
   if (ai_24 == 0) return (ld_36 * ad_0 * (ad_16 - ad_8));
   if (ai_24 == 1) return (ld_36 * ad_0 * (ad_8 - ad_16));
   return (0);
}

double f0_0(int ai_0, int ai_4, double ad_8) {
   int li_28 = OrdersTotal();
   double ld_32 = 0;
   for (int li_20 = 0; li_20 < li_28; li_20++) {
      if (OrderSelect(li_20, SELECT_BY_POS)) {
         if (ai_4 == OrderType())
            if (OrderMagicNumber() == ai_0) ld_32 += f0_1(OrderLots(), OrderOpenPrice(), ad_8, ai_4, OrderSymbol()) + OrderCommission() + OrderSwap();
      }
   }
   return (ld_32);
}
